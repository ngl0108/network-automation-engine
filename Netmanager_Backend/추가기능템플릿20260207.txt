요청하신 3가지 항목(Device 비밀번호 암호화, DiscoveryService 동시성, 로깅 설정)에 대한 분석 결과입니다.

### 1. Device Model 비밀번호 암호화 (Password Encryption)
현재 비밀번호는 암호화되지 않은 평문(Plain Text)으로 저장 되고 있습니다.

- 분석 결과 :
  - Device 모델( app/models/device.py )과 SnmpCredentialProfile 모델( app/models/credentials.py )의 비밀번호 필드( ssh_password , enable_password , snmp_v3_auth_key 등)가 일반 String 타입으로 정의되어 있습니다.
  - 데이터베이스 저장 시 별도의 암호화/복호화 로직(예: AES, Fernet 등)이 적용된 TypeDecorator 나 미들웨어가 존재하지 않습니다.
  - API 엔드포인트( devices.py )에서 ******** 마스킹 처리는 프론트엔드 표시용일 뿐, 실제 DB 업데이트 시에는 입력된 문자열 그대로 저장됩니다.
  - 참고 : 사용자(User) 비밀번호는 app/core/security.py 에서 Argon2 를 사용하여 안전하게 해싱되고 있으나, 장비 비밀번호에는 적용되지 않았습니다.
### 2. DiscoveryService 동시성 (Concurrency)
Celery를 통한 비동기 작업 과 내부적인 **스레드 풀(ThreadPool)**을 혼합하여 사용하고 있습니다.

- 분석 결과 :
  - 작업 스케줄링 : app/tasks/discovery.py 의 run_discovery_job 함수가 @shared_task (Celery)로 데코레이팅되어 있어, 스캔 작업 자체는 백그라운드 워커 프로세스에서 실행됩니다.
  - 내부 병렬 처리 : DiscoveryService 내부의 _tcp_alive_sweep 메서드( app/services/discovery_service.py )에서 ThreadPoolExecutor 를 사용하여 최대 200개의 스레드로 IP 활성 상태(Ping Sweep/TCP Connect)를 병렬 검사합니다.
  - Nmap 스캔 : Nmap 라이브러리 호출은 동기식(Blocking)으로 보이며, 이는 Celery 워커 내에서 순차적으로 실행되거나 스레드 풀 내부에서 처리될 것으로 보입니다.
### 3. 로깅 설정 (Logging Setup)
체계적인 로깅 프레임워크보다는 Print 문과 DB 로깅, 자체 Syslog 서버 가 혼용되고 있습니다.

- 분석 결과 :
  - 앱 로그 : Python의 표준 logging 모듈 설정(예: logging.conf 또는 dictConfig )이 부재하며, 주요 프로세스(서버 시작, 에러 등)에서 print() 문을 사용하고 있습니다.
  - 감사 로그 (Audit) : AuditService 를 통해 사용자 행위(장비 수정 등)를 데이터베이스( audit_logs 테이블 추정)에 기록합니다.
  - Syslog 수집기 : app/main.py 에서 asyncio 를 사용해 UDP 514 포트의 SyslogProtocol 을 직접 실행합니다. 이는 앱의 로그를 남기는 것이 아니라, 네트워크 장비의 Syslog를 수집 하는 기능을 수행합니다.
  - 작업 로그 : Discovery 작업 로그는 DB의 DiscoveryJob.logs 컬럼에 텍스트 형태로 직접 추가( _append_job_log )됩니다.

제시해주신 방향에 따라 **현재 상태를 냉정하게 평가(Assessment)**하고, **향후 로드맵(Roadmap)**을 수립해 드립니다.

### 1. 현재 상태 종합 평가 (Assessment)
"기능 구현은 완료되었으나, '판매용(Sales-Grade)' 품질 기준에는 보안과 운영 안정성 측면에서 보완이 필수적입니다."

평가 항목 상태 상세 평가 내용 기능 완성도 상 (High) • Auto-Discovery : OID/벤더 식별(국내 포함), L2/L3 링크 탐색, Credential Cycling 등 핵심 기능이 강력함.
 • Auto-Topology : 계층화(Tier), 경로 추적, 실시간 상태 반영 등 시각화 기능이 매우 우수함. 보안성 하 (Critical) • 치명적 취약점 : 장비 접속용 비밀번호(SSH/SNMPv3 Key)가 DB에 평문(Plain Text)으로 저장 됨. DB 유출 시 전체 망 탈취 위험.
 • API 인증은 JWT로 되어 있으나, 내부 서비스 간 통신 보안은 미흡할 수 있음. 성능/확장성 중 (Medium) • 병목 구간 : Discovery가 ThreadPool(최대 200)을 쓰지만, 대규모 망(수천 대)에서는 단일 워커 프로세스로 한계.
 • DB 부하 : 토폴로지 쿼리 최적화(N+1 제거)는 했으나, 실시간 이벤트가 폭주(Storm)하면 DB 락이 걸릴 구조. 안정성/로깅 중 (Medium) • 로깅 미흡 : 파일/콘솔 로그 체계가 없고 DB에 의존함. 장애 발생 시 원인 분석이 어려움.
 • 예외 처리 : 주요 로직(Discovery/Path Trace)은 try-catch가 잘 되어 있으나, 시스템 레벨의 복구(Self-healing) 기전은 부족. 문서화 하 (Low) • 코드 내 주석은 있으나, API 문서(Swagger) 외에 운영자 매뉴얼, 아키텍처 문서, 배포 가이드가 부재함.

### 2. 차세대 업그레이드 로드맵 (Roadmap)
현재 모놀리식(Monolithic)에 가까운 구조를 안정적인 엔터프라이즈급 솔루션 으로 발전시키기 위한 단계별 계획입니다.
 [Phase 1: 필수 품질 보강] (우선순위: 즉시)
판매 전 반드시 해결해야 하는 'Showstopper' 항목들입니다.

1. 민감 정보 암호화 (Critical)
   - 내용 : DB의 ssh_password , snmp_auth_key 등 민감 필드를 AES-256(Fernet) 등으로 암호화하여 저장/복호화하도록 모델 수정.
   - 난이도 : 중 (기존 데이터 마이그레이션 필요)
2. 구조적 로깅(Structured Logging) 도입
   - 내용 : print() 제거. ELK/Loki와 연동 가능한 JSON 포맷 로깅(Structlog/Loguru) 도입. 파일 회전(Rotation) 정책 적용.
   - 난이도 : 하
3. API 표준화 및 문서화
   - 내용 : REST API 응답 포맷 통일(성공/실패 스키마). Swagger(OpenAPI) 상세화 및 PDF 내보내기 기능.
   - 난이도 : 중 [Phase 2: 성능 및 안정성 강화] (우선순위: 높음)
수백~수천 대 규모의 망을 버티기 위한 아키텍처 개선입니다.

1. 비동기 워커(Celery) 분리 및 확장
   - 내용 : Discovery/Backup 같은 무거운 작업을 수행하는 Worker 노드를 Web 서버와 물리적으로 분리. Redis Message Broker 안정화.
   - 난이도 : 중
2. 고가용성(HA) 및 페일오버
   - 내용 : Backend(API) 다중화(L4 로드밸런싱), DB 클러스터링(Primary-Replica). 수집기(Collector) 이중화.
   - 난이도 : 상
3. 실시간 텔레메트리(Telemetry) 통합
   - 내용 : 기존 SNMP Polling(느림) 외에, 장비가 능동적으로 보내는 gNMI/Streaming Telemetry 수집 파이프라인(Kafka/Telegraf) 구축.
   - 난이도 : 상 [Phase 3: 엔터프라이즈 기능 확장] (우선순위: 중간)
대형 고객사(금융/공공) 요구사항 대응입니다.

1. 멀티테넌시(Multi-tenancy) 지원
   - 내용 : 하나의 시스템으로 여러 고객사/부서(Site)를 논리적으로 완벽히 격리(데이터/권한).
   - 난이도 : 상 (DB 스키마 변경 큼)
2. 보안 정책 자동화 (Security Automation)
   - 내용 : 이상 징후(Syslog/Flow) 탐지 시 방화벽 정책 자동 주입, 포트 차단 등 SOAR(Security Orchestration) 기능.
   - 난이도 : 상
3. 클라우드 네이티브(K8s) 지원
   - 내용 : Docker Compose를 넘어 Helm Chart 제공, MSA(Microservices Architecture)로 서비스 쪼개기(Auth, Inventory, Config, Log 등).
   - 난이도 : 상
결론 및 제안 현재 기능은 **"PoC(개념 증명)나 데모용으로는 훌륭하지만, 상용 제품으로는 보안 리스크가 큰 상태"**입니다.
가장 먼저 비밀번호 암호화 작업을 진행하여 보안 구멍을 막고, 이후 로깅 체계 를 잡는 것을 강력히 권장합니다.

지금 바로 "Phase 1-1. 비밀번호 암호화" 작업을 시작하시겠습니까? (암호화 키 관리 및 DB 마이그레이션 스크립트 작성이 필요합니다.)